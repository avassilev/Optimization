% !TeX spellcheck = en_GB
\documentclass[10pt]{beamer}
\usetheme{CambridgeUS}
%\usetheme{Boadilla}
\definecolor{myred}{RGB}{163,0,0}
%\usecolortheme[named=blue]{structure}
\usecolortheme{dove}
\usefonttheme[]{professionalfonts}
\usepackage[english]{babel}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{xcolor}
\usepackage{bm}
\usepackage{gensymb}
\usepackage{verbatim} 
\usepackage{paratype}
\usepackage{mathpazo}
\usepackage{listings}
\lstset{language=Python}

\usepackage{tikz}
\usetikzlibrary{matrix}

\DeclareMathOperator*{\interior}{int}

% Number theorem environments
\setbeamertemplate{theorem}[ams style]
\setbeamertemplate{theorems}[numbered]

% Reset theorem-like environments so that each is numbered separately
\usepackage{etoolbox}
\undef{\definition}
\theoremstyle{definition}
\newtheorem{definition}{\translate{Definition}}
\newtheorem{Fact}{\translate{Fact}}

% Change colours for theorem-like environments
\definecolor{mygreen1}{RGB}{0,96,0}
\definecolor{mygreen2}{RGB}{229,239,229}
\setbeamercolor{block title}{fg=white,bg=mygreen1}
\setbeamercolor{block body}{fg=black,bg=mygreen2}



\alt<presentation>
{\lstset{%
  basicstyle=\footnotesize\ttfamily,
  commentstyle=\slshape\color{green!50!black},
  frame = single,  
  keywordstyle=\bfseries\color{blue!50!black},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
  %escapechar=\#,
  showstringspaces = false,
  showtabs = false,
  tabsize = 2,
  emphstyle=\color{red}}
}
{
  \lstset{%
    basicstyle=\ttfamily,
    keywordstyle=\bfseries,
    commentstyle=\itshape,
    escapechar=\#,
    showtabs = false,
	tabsize = 2,
    emphstyle=\bfseries\color{red}
  }
} 

\title{R401: Statistical and Mathematical Foundations}
\subtitle{Lecture 20: Infinite-Horizon Stochastic Optimal Control in Discrete Time}
\author{Andrey Vassilev}

\date{2016/2017} 
    
\AtBeginSection{\frame{\usebeamerfont{section title}\centering\insertsection}}

\begin{document}
\maketitle



\begin{frame}[fragile]
\frametitle{Lecture Contents}
\tableofcontents
\end{frame}

\begin{section}{Introduction}\label{sec:intro}

\begin{frame}
\frametitle{Уводни бележки}
\begin{itemize}
\item Инструментариум -- динамични оптимизационни задачи със стохастичен елемент
\begin{itemize}
  \item разлика с детерминистични оптимизационни задачи; правила за взимане на решения/политики
  \item методите за решаване се учат на алгоритмично ниво в този курс
  \item повече подробности и по-строго математическо изложение:
  \begin{itemize}
    \item Stokey and Lucas (1989)
    \item D. Bertsekas, S. Shreve. Stochastic Optimal Control: The Discrete-Time Case. New
York, Academic Press, 1978
    \item John Stachurski. Economic Dynamics --  Theory and Computation. MIT Press, 2009
  \end{itemize}
\end{itemize}
\end{itemize}
\end{frame}



\begin{frame}
\frametitle{Уводни бележки}
\begin{itemize}
\item Основни етапи в решаването на динамични стохастични модели на общо равновесие
\begin{itemize}
  \item формулиране -- цел $\rightarrow$ механизми, шокове (структурна интерпретация)
  \item извеждане на НУ за оптималност
  \item пресмятане на стационарно състояние -- детерминистични стационарни състояния
  \item линейно приближение на модела около стационарното състояние -- лог-линеаризация
  \item калибриране/оценяване
  \item симулации, прогнози
  \begin{itemize}
    \item IRF (функция на импулсна реакция/импулсен отклик)
    \item преход към дадено стационарно състояние
    \item исторически декомпозиции
  \end{itemize}
\end{itemize}
\end{itemize}
\end{frame}



\begin{frame}\setcounter{slidenum}{1}
\frametitle{Въвеждане на стохастичен елемент в задачата с явни управления (\arabic{slidenum})}
Нека сега във фазовите уравнения участва и случайна величина:
\beq x_{t+1}=f(x_t,u_t,{\color{red}\epsilon_t}),\quad x_0 \text{ -- дадено} \label{eq:statestoch}\eeq

Тогава $ \{x_t\} $ също стават случайни, съответно случайна става и $ f^0(x_t,u_t) $.

Това налага модификация на целевия функционал -- там трябва да се вземе математическо очакване (условно по наличната информация към съответния момент). Нека за простота сме в момент $ t=0 $:
\beq \sup_{\{u_t\}_{t=0}^\infty}{\color{red}E_0}\sum_{t=0}^\infty
\beta^t f^0(x_t,u_t)\label{eq:objstoch}\eeq
\end{frame}



\begin{frame}\stepcounter{slidenum}
\frametitle{Въвеждане на стохастичен елемент в задачата с явни управления (\arabic{slidenum})}
\begin{itemize}
\item Последователност на събитията в рамките на един период:\[ x_t \quad \rightarrow \quad u_t \quad \rightarrow \quad \epsilon_t \quad \Longrightarrow \quad x_{t+1}\quad \rightarrow \quad \cdots \] Т.е. когато вземаме решението не сме сигурни къде ще попаднем през следващия период.

В някои източници пишат  $ x_{t+1}=f(x_t,u_t,\epsilon_{t+1}) $, за да подчертаят тази последователност.
\item За разлика от детерминистичните задачи, тук решението не може да бъде предварително избрана траектория $ u^*_0, u^*_1, \ldots $ Например, не може в момент 0 да определим $ u_5 $, понеже не знаем колко ще бъде $ x_5 $ (то е случайно).
\item Поради това оптималното поведение се задава като правило за реакция $ u_t=\mu(x_t) $, което е функция от състоянието $ x_t $ на системата. 
\end{itemize}
\end{frame}


\begin{frame}\stepcounter{slidenum}
\frametitle{Въвеждане на стохастичен елемент в задачата с явни управления (\arabic{slidenum})}
\begin{itemize}
\item При горната структура на модела реално се взема решение само за настоящия момент от времето.
\item Всичко друго напред остава план, които може да не бъде осъществен.
\item На следващата стъпка моделът се решава отново за новите начални условия.
\item Това има следствия за прилагането на оператора за условно математическо очакване при пресмятането на необходими условия за оптималност.
\end{itemize}
\end{frame}
\end{section}

\begin{section}{Necessary conditions}\label{sec:NCs}
\setcounter{slidenum}{1}
\begin{frame}
\frametitle{Извеждане на необходими условия за оптималност
(\arabic{slidenum})}\framesubtitle{Обща постановка
(алгоритмично решение)} \textbf{Задача:}
$$\max_{u_{s+t}}E_s\sum_{t=0}^\infty \beta^t f^0(x_{s+t},u_{s+t})$$ при
условие
$$x_{s+t+1}=f_{s+t}(x_{s+t},u_{s+t},\epsilon_{s+t}),\quad x_s\textrm{ --
известно},$$ където $x_{s+t}\in \mathbb{R}^n$ и $u_{s+t}\in \mathbb{R}^m$.

\textbf{Лагранжиан:} $$\mathcal{L}=E_s\sum_{t=0}^\infty \beta^t
\left\{ f^0(x_{s+t},u_{s+t}) + \langle \lambda_{s+t},
f_{s+t}(x_{s+t},u_{s+t},\epsilon_{s+t})-x_{s+t+1} \rangle \right\}$$

\end{frame}


\stepcounter{slidenum}\begin{frame} \frametitle{Извеждане на
необходими условия за оптималност
(\arabic{slidenum})}\framesubtitle{Обща постановка
(алгоритмично решение)} При определени условия (изпълнени за
стандартни икономически задачи), решението удовлетворява
$$\frac{\partial \mathcal{L}}{\partial u_{s+t}^i}=0,~i=1,\ldots,m; \quad \frac{\partial \mathcal{L}}{\partial x_{s+t+1}^j}=0,~j=1,\ldots,n,~\forall t \geq 0,\textrm{ т.е.} $$
$$E_s
\left\{ \frac{\partial}{\partial u_{s+t}^i}f^0(x_{s+t},u_{s+t}) + \sum_{k=1}^n \lambda^k_{s+t}
\frac{\partial}{\partial u_{s+t}^i}f^k_{s+t}(x_{s+t},u_{s+t},\epsilon_{s+t}) \right\}=0,$$
\begin{equation*}
    \begin{split}
\beta E_s
\Biggl\{ & \frac{\partial}{\partial x_{s+t+1}^j} f^0(x_{s+t+1},u_{s+t+1}) + \\ &  \sum_{k=1}^n \lambda^k_{s+t+1}
\frac{\partial}{\partial x_{s+t+1}^j}f^k_{s+t}(x_{s+t+1},u_{s+t+1},\epsilon_{s+t+1}) \Biggr\} =  E_s
\left\{ \lambda_{s+t}^j \right\}
    \end{split}
\end{equation*}
\end{frame}



\stepcounter{slidenum}\begin{frame}
\frametitle{Извеждане на необходими условия за оптималност (\arabic{slidenum})}
\framesubtitle{Практически съвети и коментари}
\begin{itemize}
\item По-лесно е задачата да се напише за $ s=0 $. Стандартните задачи са инвариантни по времето и това не пречи.
\item Удобно е да приложим оператора за очакването накрая, т.е. след диференцирането и последващите пресмятания.
\item Диференцираме по всички управления за произволен момент $ t $ и по всички фазови променливи за момент $ t+1 $. Приравняваме на нула съответните изрази.
\item При прилагане на оператора за условно очакване, той се прилага към момент $ t $.
\end{itemize}
\end{frame}



\stepcounter{slidenum}\begin{frame}
\frametitle{Извеждане на необходими условия за оптималност (\arabic{slidenum})}
\framesubtitle{Практически съвети и коментари}
\begin{itemize}
\item Освен горните необходими условия за оптималност, едно решение трябва също така да удовлетворява и стохастичен вариант на условие за трансверсалност. Засега пренебрегваме този детайл, но в разглежданите модели ще осигуряваме това условие да е изпълнено. 
\item В някои случаи се използва конвенция за записване на фазовите уравнения от типа \[ x_t = f_t(x_{t-1},u_t,\epsilon_t). \] (Може да се интерпретира като измерване на фазовите променливи в края на текущия период, а не в началото на следващия, т.е. 31 декември вместо 1 януари.) В този случай диференцирането се извършва по фазовите променливи в момент $ t $ вместо $ t+1 $.
\end{itemize}
\end{frame}

\end{section}


\begin{section}{Examples}\label{sec:ex}

\begin{frame}\setcounter{slidenum}{1}
\frametitle{Пример I (\arabic{slidenum})}
\framesubtitle{}
Формулировка:
\[ \max_{\{C_t\}} E_0 \sum_{t=0}^{\infty}\beta^t \frac{C_t^{1-\sigma}}{1-\sigma} \]
\[ A_{t+1}=(1+r)A_t + Y_t - C_t,~Y_t=\bar{Y}-\epsilon_t \]
$ C_t $ -- потребление, $ A_t $ -- активи, $ Y_t $ -- доход, $ r $ -- лихвен процент \bigskip

Лагранжиан:\[ \mathcal{L} = \sum_{t=0}^{\infty}\beta^t \left\{\frac{C_t^{1-\sigma}}{1-\sigma}+\lambda_t \left[(1+r)A_t + Y_t - C_t - A_{t+1}\right] \right\} \]
\end{frame}




\stepcounter{slidenum}\begin{frame}
\frametitle{Пример I (\arabic{slidenum})}
\framesubtitle{}
Необходими условия:
\[ \frac{\partial \mathcal{L} }{\partial C_t} = \beta^t \{C_t^{-\sigma}-\lambda_t\} = 0 \quad\Longrightarrow\quad C_t^{-\sigma}=\lambda_t \]
\[ \frac{\partial \mathcal{L} }{\partial A_{t+1}} = -\beta^t \lambda_t + \beta^{t+1}\lambda_{t+1}(1+r) = 0 \quad\Longrightarrow\quad \lambda_t = \beta(1+r)\lambda_{t+1} \]

Прилагаме $ E_t $:
\[ E_t \{C_t^{-\sigma}\}=E_t \{\lambda_t\} \quad\Longrightarrow\quad C_t^{-\sigma}=\lambda_t \]
\[ E_t \{\lambda_t\} = E_t\{\beta(1+r)\lambda_{t+1}\} \quad\Longrightarrow\quad \lambda_t = \beta(1+r)E_t\{\lambda_{t+1}\} \]

След заместване на $ \lambda_t = C_t^{-\sigma} $ в последния израз:
\[ C_t^{-\sigma} = \beta (1+r)E_t \left\{C_{t+1}^{-\sigma}\right\} \] \pause
\textbf{Задача:} Решете Пример I, ако фазовото уравнение е записано според конвенцията $A_{t}=(1+r)A_{t-1} + Y_t - C_t$.
\end{frame}


\begin{frame}\setcounter{slidenum}{1}
\frametitle{Пример II (\arabic{slidenum})}
\framesubtitle{}
Формулировка:
\[ \max_{\{C_t\},\{N_t\}} E_0 \sum_{t=0}^{\infty}\beta^t U(C_t,N_t) \]
\[ Q_t B_t = B_{t-1} + W_t N_t - P_t C_t - T_t  \]
$ C_t $ -- потребление, $ N_t $ -- количество труд (отработени часове), $ B_t $ -- дисконтови облигации, закупувани в период $ t $ и падежиращи през $ t+1 $, $ Q_t $ -- цена на облигациите, $ P_t $ -- цена на потребителската стока, $ W_t $ -- заплата, $ T_t $ -- данъци/трансфери \bigskip

Лагранжиан:\[ \mathcal{L} = \sum_{t=0}^{\infty}\beta^t \left\{U(C_t,N_t)+\lambda_t \left[ B_{t-1} + W_t N_t - P_t C_t - T_t - Q_t B_t \right] \right\} \]
\end{frame}




\begin{frame}\stepcounter{slidenum}
\frametitle{Пример II (\arabic{slidenum})}
\framesubtitle{}
Въвеждаме $ U_{c,t} := \frac{\partial}{\partial C}U(C_t,N_t)$, $ U_{n,t} := \frac{\partial}{\partial N}U(C_t,N_t)$.\bigskip

Диференцираме по управленията:
\[ \frac{\partial \mathcal{L} }{\partial C_t} = \beta^t U_{c,t} - \beta^t P_t \lambda_t = 0 \quad\Longrightarrow\quad \lambda_t = \frac{U_{c,t}}{P_t} \]
\[  \frac{\partial \mathcal{L} }{\partial N_t} = \beta^t U_{n,t}+\beta^t \lambda_t W_t =0 \quad\Longrightarrow\quad \lambda_t W_t = -U_{n,t}  \]\bigskip

От предходните две уравнения можем да получим \[ \frac{W_t}{P_t} = -\frac{U_{n,t}}{U_{c,t}}. \]
\end{frame}




\begin{frame}\stepcounter{slidenum}
\frametitle{Пример II (\arabic{slidenum})}
\framesubtitle{}
Диференцираме по фазовата променлива (в момент $ t $ за този случай!):
\[ \frac{\partial \mathcal{L} }{\partial B_t} = -\beta^t Q_t \lambda_t + \beta^{t+1}\lambda_{t+1} = 0 \quad\Longrightarrow\quad Q_t \lambda_t = \beta E_t \{\lambda_{t+1}\} \]

След заместване на израза за $ \lambda $ в моменти $ t $ и $ t+1 $, имаме 
\[ Q_t = \beta E_t \left\{ \frac{U_{c,t+1}}{U_{c,t}}\frac{P_t}{P_{t+1}} \right\} .  \]

Окончателно получаваме \[ \frac{W_t}{P_t} = -\frac{U_{n,t}}{U_{c,t}}, \quad Q_t = \beta E_t \left\{ \frac{U_{c,t+1}}{U_{c,t}}\frac{P_t}{P_{t+1}} \right\} \text{ за } t=0,1,2,\ldots \]

\textbf{Задача:} Как изглеждат горните необходими условия, ако функцията на полезност има вида $ U(C_t,N_t)=\frac{C_t^{1-\sigma}}{1-\sigma}-\frac{N_t^{1+\varphi}}{1+\varphi},~\sigma>0,~\varphi \geq 1 $?
\end{frame}



\begin{frame}
\frametitle{Задача: решения за спестяване и миграция}
\framesubtitle{}
\[ \max_{\{C_t\},\{Z_t\}} E_0 \sum_{t=0}^{\infty}\beta^t \ln C_t  \]
\[ A_{t+1}=(1+r)A_t+w(X_t)-P_t C_t -\xi Z_t^2,\quad w(X_t) = \bar{w}(X_t)+\epsilon_t \]
\[ X_{t+1}  = X_t+Z_t \]

Означенията са както преди, като в допълнение $ X_t $ е положението на икономическия агент в пространството (в случая реалната права), $ w(\cdot) $ е заплатата, зависеща от положението в пространството, $ \bar{w}(\cdot) $ е гладка функция, а променливата $ Z_t $ управлява скоростта на преместване в пространството.
\end{frame}
\end{section}


\begin{section}{Linear approximation and log-linearization}\label{sec:llin}

\begin{frame}\setcounter{slidenum}{1}
\frametitle{Линейни приближения (\arabic{slidenum})}
\framesubtitle{Общи положения}
\begin{itemize}
\item За решаването на един динамичен макроикономически модел е удобно да се разглежда приближение на уравненията от модела.
\item Обикновено ни интересува поведението на системата в околност на някакво равновесие (стационарно състояние) и приближението се прави около него.
\item Най-често приближенията са линейни: трансформираме оригиналното, нелинейно уравнение в линейно по някакъв начин.
\end{itemize}
\end{frame}


\begin{frame}\stepcounter{slidenum}
\frametitle{Линейни приближения (\arabic{slidenum})}
\framesubtitle{Варианти за линейни приближения}
\begin{itemize}
\item Логаритмуване (за променливи с положителни стойности):
\[ \frac{W_t}{P_t} = C_t^\sigma N_t^\varphi \quad\Longrightarrow\quad w_t - p_t = \sigma c_t + \varphi n_t, \] където $ w_t := \ln W_t $, $ p_t := \ln P_t $ и т.н. 
\item Директно приближение по формулата на Тейлър
\item Лог-линеаризация (ще я разгледаме отделно)
\end{itemize}
\end{frame}




\setcounter{slidenum}{1}\begin{frame} \frametitle{Лог-линеаризация
(\arabic{slidenum})}\framesubtitle{Общи положения}
Нека имаме $x_t \neq 0$ и $\bar{x}$ е дадена стойност на $x_t$ (най-често стационарна стойност).

\textbf{Логаритмично отклонение (лог-отклонение)} на $x_t$ от $\bar{x}$: $$\hat{x}_t := \ln \left(\frac{x_t}{\bar{x}}\right).$$

Предвид $$\ln (1+z)\approx \ln (1+z_0)+ \frac{1}{1+z_0}(z-z_0),$$ за $z_0=0$ получаваме $\ln (1+z) \approx z$ и съответно $$\ln \left(\frac{x_t}{\bar{x}}\right) = \ln \left(1+\frac{x_t-\bar{x}}{\bar{x}}\right)\approx \frac{x_t-\bar{x}}{\bar{x}}. $$
\end{frame}

\stepcounter{slidenum}\begin{frame} \frametitle{Лог-линеаризация
(\arabic{slidenum})}\framesubtitle{Общи положения}
Нека $y_t=f(x_t,z_t)$, където $f$ е диференцируема. \bigskip

Тогава $$\hat{y}_t = \frac{f_x(\bar{x},\bar{z})\bar{x}}{f(\bar{x},\bar{z})}\hat{x}_t + \frac{f_z(\bar{x},\bar{z})\bar{z}}{f(\bar{x},\bar{z})}\hat{z}_t$$

Имаме:
\begin{enumerate}
  \item $y_t=x_t z_t \quad \Rightarrow \quad \hat{y}_t = \hat{x}_t + \hat{z}_t .$
  \item $y_t=x_t / z_t \quad \Rightarrow \quad \hat{y}_t = \hat{x}_t - \hat{z}_t .$
  \item $y_t=x_t + z_t \quad \Rightarrow \quad \hat{y}_t = \frac{\bar{x}}{\bar{y}}\hat{x}_t + \frac{\bar{z}}{\bar{y}}\hat{z}_t .$
  \item $g(x_t,y_t)=0 \quad \Rightarrow \quad \hat{y}_t = - \frac{g_x(\bar{x},\bar{y})\bar{x}}{g_y(\bar{x},\bar{y})\bar{y}}\hat{x}_t $
\end{enumerate}
\end{frame}



\begin{frame}[fragile]
\frametitle{Homework}
\framesubtitle{}

\end{frame}


\begin{frame}[fragile]
\frametitle{Readings}
Additional readings:\bigskip

Syds\ae{}ter et al. [SHSS] \emph{Further mathematics for economic analysis}. Chapter 12.\bigskip
\end{frame}

\end{document}

